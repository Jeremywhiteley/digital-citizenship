{
    "swagger": "2.0",
    "info": {
        "version": "1.0",
        "title": "profile-api",
        "description": "Profile and preferences management Profile and preferences management"
    },
    "host": "localhost:3000",
    "basePath": "/v1",
    "schemes": [
        "https"
    ],
    "consumes": [
        "application/json"
    ],
    "produces": [
        "application/json"
    ],
    "securityDefinitions": {
        "Authorization": {
            "name": "Authorization",
            "type": "apiKey",
            "in": "header"
        }
    },
    "paths": {
        "/profile/{fiscal_code}": {
            "parameters": [
                {
                    "name": "fiscal_code",
                    "in": "path",
                    "required": true,
                    "type": "string",
                    "pattern": "^[A-Z]{6}\\d{2}[A-Z]\\d{2}[A-Z]\\d{3}[A-Z]$"
                }
            ],
            "get": {
                "operationId": "GetProfileLatestVersionForFiscalCode",
                "summary": "GetProfileLatest",
                "tags": [
                    "User Operations"
                ],
                "description": "Returns the attributes for latest version of the profile identified by the provided `fiscal_code`.",
                "responses": {
                    "200": {
                        "description": "",
                        "schema": {
                            "type": "object",
                            "properties": {
                                "version": {
                                    "type": "number",
                                    "minimum": 1,
                                    "exclusiveMinimum": false
                                },
                                "created_at": {
                                    "type": "number",
                                    "minimum": 0
                                },
                                "attributes": {
                                    "$ref": "#/definitions/attributes"
                                }
                            },
                            "required": [
                                "version",
                                "created_at"
                            ]
                        }
                    },
                    "404": {
                        "$ref": "#/responses/trait:errorNotFound:404"
                    }
                },
                "security": [
                    {
                        "Authorization": []
                    }
                ],
                "x-stoplight": {
                    "id": "GetProfileLatestVersionForFiscalCode",
                    "beforeScript": null,
                    "afterScript": null,
                    "public": true,
                    "mock": {
                        "statusCode": 200,
                        "dynamic": false,
                        "enabled": true
                    }
                }
            },
            "post": {
                "operationId": "CreateProfile",
                "summary": "CreateProfile",
                "tags": [
                    "User Operations"
                ],
                "description": "Creates a new profile associated to the provided `fiscal_code`.\n\nThe new profile will have an initial version of `1`.",
                "responses": {
                    "201": {
                        "$ref": "#/responses/trait:successProfileVersionCreated:201"
                    },
                    "409": {
                        "$ref": "#/responses/trait:errorConflict:409"
                    },
                    "422": {
                        "$ref": "#/responses/trait:errorUnprocessableEntity:422"
                    }
                },
                "security": [
                    {
                        "Authorization": []
                    }
                ],
                "x-stoplight": {
                    "id": "CreateProfile",
                    "beforeScript": "function (ctx, request) {\n  \n}",
                    "afterScript": "function (ctx, request, response) {\n\n}",
                    "public": true,
                    "mock": {
                        "enabled": false,
                        "dynamic": false,
                        "statusCode": 200
                    }
                }
            }
        },
        "/profile/{fiscal_code}/{version}": {
            "parameters": [
                {
                    "name": "fiscal_code",
                    "in": "path",
                    "required": true,
                    "type": "string",
                    "pattern": "^[A-Z]{6}\\d{2}[A-Z]\\d{2}[A-Z]\\d{3}[A-Z]$"
                },
                {
                    "name": "version",
                    "in": "path",
                    "required": true,
                    "type": "number",
                    "minimum": 1
                }
            ],
            "get": {
                "operationId": "GetProfileVersionForFiscalCode",
                "summary": "GetProfileVersion",
                "tags": [
                    "User Operations"
                ],
                "description": "Returns the attributes for the profile identified by the provided `fiscal_code` and `version` number.\n\nThe first `version` of a profile is `1`",
                "responses": {
                    "200": {
                        "description": "",
                        "schema": {
                            "type": "object",
                            "properties": {
                                "version": {
                                    "type": "number",
                                    "minimum": 1,
                                    "exclusiveMinimum": false
                                },
                                "created_at": {
                                    "type": "number",
                                    "minimum": 0
                                },
                                "attributes": {
                                    "$ref": "#/definitions/attributes"
                                }
                            },
                            "required": [
                                "version",
                                "created_at"
                            ]
                        }
                    },
                    "404": {
                        "$ref": "#/responses/trait:errorNotFound:404"
                    }
                },
                "security": [
                    {
                        "Authorization": []
                    }
                ],
                "x-stoplight": {
                    "id": "GetProfileVersionForFiscalCode",
                    "beforeScript": null,
                    "afterScript": null,
                    "public": true,
                    "mock": {
                        "statusCode": 200,
                        "dynamic": false,
                        "enabled": true
                    }
                }
            },
            "put": {
                "operationId": "UpdateProfileForFiscalCode",
                "summary": "UpdateProfile",
                "tags": [
                    "User Operations"
                ],
                "description": "Updates one or more attributes of a profile identified by `fiscal_code` and `version`.\n\nOn successful update, a new profile version gets created (by incrementing the version number from the previous one).\n\nIf the provided `version` is not the latest available version for that profile, the request will fail with a [409 - Conflict](https://httpstatuses.com/409) error, meaning that the profile was concurrently updated (and a new version created) by another client.",
                "parameters": [
                    {
                        "name": "body",
                        "in": "body",
                        "schema": {
                            "$ref": "#/definitions/attributes"
                        }
                    }
                ],
                "responses": {
                    "201": {
                        "$ref": "#/responses/trait:successProfileVersionCreated:201"
                    },
                    "404": {
                        "$ref": "#/responses/trait:errorNotFound:404"
                    },
                    "409": {
                        "$ref": "#/responses/trait:errorConflict:409"
                    },
                    "422": {
                        "$ref": "#/responses/trait:errorUnprocessableEntity:422"
                    }
                },
                "security": [
                    {
                        "Authorization": []
                    }
                ],
                "x-stoplight": {
                    "id": "UpdateProfileForFiscalCode",
                    "beforeScript": null,
                    "afterScript": null,
                    "public": true,
                    "mock": {
                        "statusCode": 200,
                        "dynamic": false,
                        "enabled": false
                    }
                }
            }
        }
    },
    "responses": {
        "trait:errorNotFound:404": {
            "description": "",
            "schema": {
                "$ref": "#/definitions/error"
            }
        },
        "trait:errorConflict:409": {
            "description": "",
            "schema": {
                "$ref": "#/definitions/error"
            }
        },
        "trait:successProfileVersionCreated:201": {
            "description": "",
            "schema": {
                "$ref": "#/definitions/profile"
            }
        },
        "trait:errorUnprocessableEntity:422": {
            "description": "",
            "schema": {
                "type": "object",
                "properties": {
                    "message": {
                        "type": "string"
                    },
                    "validation_errors": {
                        "type": "array",
                        "items": {
                            "type": "object",
                            "properties": {
                                "field": {
                                    "type": "string"
                                },
                                "error": {
                                    "type": "string"
                                }
                            }
                        }
                    }
                },
                "required": [
                    "message"
                ]
            }
        }
    },
    "definitions": {
        "attributes": {
            "title": "Attributes",
            "type": "object",
            "properties": {
                "email": {
                    "type": "string",
                    "maxLength": 256,
                    "format": "email"
                },
                "mobile": {
                    "type": "string",
                    "maxLength": 64,
                    "pattern": "^\\+[1-9]\\d+$"
                },
                "locale": {
                    "type": "string",
                    "pattern": "^[a-z]{2}(_[A-Z]{2})?$"
                }
            },
            "x-stoplight": {
                "id": "attributes",
                "name": "Attributes",
                "public": true
            }
        },
        "error": {
            "title": "Error",
            "type": "object",
            "properties": {
                "message": {
                    "type": "string"
                }
            },
            "x-stoplight": {
                "id": "error",
                "name": "Error",
                "public": true
            }
        },
        "profile": {
            "title": "Profile",
            "type": "object",
            "properties": {
                "version": {
                    "type": "number"
                },
                "created_at": {
                    "type": "number",
                    "minimum": 0
                },
                "attributes": {
                    "$ref": "#/definitions/attributes"
                }
            },
            "required": [
                "version",
                "created_at"
            ],
            "x-stoplight": {
                "id": "profile",
                "name": "Profile",
                "public": true
            }
        }
    },
    "x-stoplight": {
        "version": {
            "groups": {
                "utilFuncs": [],
                "savedEntries": [],
                "tests": [],
                "traits": [],
                "docs": [
                    {
                        "divider": false,
                        "items": [
                            {
                                "_id": "errorNotFound",
                                "type": "traits"
                            },
                            {
                                "_id": "errorConflict",
                                "type": "traits"
                            },
                            {
                                "_id": "successProfileVersionCreated",
                                "type": "traits"
                            },
                            {
                                "_id": "errorUnprocessableEntity",
                                "type": "traits"
                            }
                        ],
                        "name": "Responses",
                        "description": "Commond error responses"
                    },
                    {
                        "items": [
                            {
                                "_id": "GetProfileLatestVersionForFiscalCode",
                                "type": "endpoints"
                            },
                            {
                                "type": "endpoints",
                                "_id": "GetProfileVersionForFiscalCode"
                            },
                            {
                                "_id": "CreateProfile",
                                "type": "endpoints"
                            },
                            {
                                "type": "endpoints",
                                "_id": "UpdateProfileForFiscalCode"
                            }
                        ],
                        "name": "User Operations",
                        "divider": false
                    },
                    {
                        "items": [
                            {
                                "type": "schemas",
                                "_id": "attributes"
                            },
                            {
                                "type": "schemas",
                                "_id": "error"
                            },
                            {
                                "_id": "profile",
                                "type": "schemas"
                            }
                        ],
                        "description": "Models make up the core input and ouput structures in this API. They are used in endpoint request and response bodies.",
                        "name": "Models"
                    }
                ]
            }
        },
        "functions": {},
        "textSections": {},
        "mock": {
            "dynamic": false,
            "enabled": true
        }
    },
    "x-tests": {}
}