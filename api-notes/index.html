<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>API notes - Digital Citizenship</title>
  

  <link rel="shortcut icon" href="../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "API notes";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script>
  <script src="../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Digital Citizenship</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="..">Home</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 current">
        <a class="current" href="./">API notes</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#api-notes">API notes</a></li>
                
                    <li><a class="toctree-l4" href="#users-preferences">User’s preferences</a></li>
                
                    <li><a class="toctree-l4" href="#notifications-api">Notifications API</a></li>
                
                    <li><a class="toctree-l4" href="#openapis-mocking">OpenAPIs mocking</a></li>
                
                    <li><a class="toctree-l4" href="#guidelines">Guidelines</a></li>
                
            
            </ul>
        
    </li>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Digital Citizenship</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>API notes</li>
    <li class="wy-breadcrumbs-aside">
      
        
          <a href="https://github.com/teamdigitale/cittadinanza-digitale" class="icon icon-github"> Edit on GitHub</a>
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="api-notes">API notes</h1>
<p>Notes about the APIs and OpenAPI / Swagger mocking.</p>
<h2 id="users-preferences">User’s preferences</h2>
<h3 id="scim">SCIM</h3>
<p>SCIM is a REST/API protocol for user provisioning:<br />
<a href="http://www.simplecloud.info/"><em>http://www.simplecloud.info/</em></a></p>
<p>Producing a SCIM-compatbile API for user's preferences COULD
bring some advantages.</p>
<h3 id="what-problems-scim-solves">What problems SCIM solves</h3>
<ul>
<li>Resources’ Schema extensions (custom attributes)</li>
<li>Bulk operations (CRUD)</li>
<li>Search and fields filtering and sorting</li>
<li>Common User schema (w/SAML)</li>
<li>Users groups (schema)</li>
<li>Interoperable implementations (client and server)</li>
</ul>
<h3 id="scim-references">SCIM References</h3>
<p><a href="https://tools.ietf.org/html/rfc7643"><em>https://tools.ietf.org/html/rfc7643</em></a><br />
<a href="https://tools.ietf.org/html/rfc7644"><em>https://tools.ietf.org/html/rfc7644</em></a><br />
<a href="https://tools.ietf.org/html/rfc7642"><em>https://tools.ietf.org/html/rfc7642</em></a>  </p>
<p>User preferences activity feed (changelog):<br />
<a href="https://tools.ietf.org/html/draft-hunt-scim-notify-00"><em>https://tools.ietf.org/html/draft-hunt-scim-notify-00</em></a></p>
<p>Activity feed reference implementation:<br />
<a href="https://github.com/jirmauritz/scim-notification-hub"><em>https://github.com/jirmauritz/scim-notification-hub</em></a></p>
<h4 id="who-uses-scim">Who uses SCIM</h4>
<ul>
<li><a href="https://developers.facebook.com/docs/workplace/account-management/api"><em>Facebook</em></a></li>
<li><a href="https://docs.oracle.com/cd/E52734_01/oim/OMDEV/scim.htm#OMDEV5526"><em>Oracle</em></a></li>
<li><a href="https://docs.cloudfoundry.org/adminguide/uaa-user-management.html"><em>CloudFoundry</em></a></li>
<li><a href="https://api.slack.com/scim"><em>Slack</em></a></li>
<li><a href="https://developers.trello.com/advanced-reference/scim"><em>Trello</em></a></li>
<li><a href="https://developer.github.com/v3/scim/"><em>GitHub</em></a></li>
<li><a href="https://docs.microsoft.com/it-it/azure/active-directory/active-directory-scim-provisioning"><em>Microsoft</em></a></li>
</ul>
<h4 id="ready-made-implementations">“Ready made” implementations</h4>
<p><a href="http://www.simplecloud.info/#implementations"><em>http://www.simplecloud.info/#implementations</em></a></p>
<table>
<thead>
<tr>
<th></th>
<th align="center"><strong>WSO2</strong></th>
<th align="right"><strong>OSIAM</strong></th>
<th><strong>Gluu</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Maturity</strong></td>
<td align="center">****</td>
<td align="right">*</td>
<td>***</td>
</tr>
<tr>
<td><strong>Project activity</strong></td>
<td align="center">***</td>
<td align="right">*</td>
<td>***</td>
</tr>
<tr>
<td><strong>Documentation</strong></td>
<td align="center">***</td>
<td align="right">*</td>
<td>***</td>
</tr>
</tbody>
</table>
<h5 id="wso2-charon">WSO2 + charon</h5>
<p><a href="https://github.com/wso2/charon"><em>https://github.com/wso2/charon</em></a></p>
<ul>
<li>
<p>current stable version (wso2 charon 2.1.0) does not support filters (user search) other than ‘Eq’</p>
</li>
<li>
<p>charon 3.x filtering is much more useful but maven archives has only 2.x:     <a href="https://mvnrepository.com/artifact/org.wso2.charon/org.wso2.charon.core"><em>https://mvnrepository.com/artifact/org.wso2.charon/org.wso2.charon.core</em></a></p>
</li>
<li>
<p>wso2 charon 3.x much more useful as library but you you have to provide the API layer and the persistence layer (UserManager) by yourself</p>
</li>
<li>
<p>missing docs about adding custom attributes</p>
</li>
</ul>
<h5 id="osiam">OSIAM</h5>
<p><a href="https://github.com/osiam/osiam"><em>https://github.com/osiam/osiam</em></a></p>
<ul>
<li>
<p>very poor documentation</p>
</li>
<li>
<p>very low activity in the last year</p>
</li>
<li>
<p>SCIM bulk actions not yet implemented</p>
</li>
<li>
<p>OSIAM does not yet support complex data types for extensions. According to docs "The absence of this feature will be addressed in a future version"</p>
</li>
</ul>
<h5 id="gluu">Gluu</h5>
<p><a href="https://www.gluu.org/gluu-server/"><em>https://www.gluu.org/gluu-server/</em></a></p>
<ul>
<li>looks very good but cannot install on small vm</li>
</ul>
<h2 id="notifications-api">Notifications API</h2>
<h3 id="existing-apis-for-messaging">Existing APIs for messaging</h3>
<ul>
<li>
<p><a href="https://firebase.google.com/docs/cloud-messaging/send-message"><em>https://firebase.google.com/docs/cloud-messaging/send-message</em></a></p>
</li>
<li>
<p><a href="https://github.com/alphagov/notifications-api"><em>https://github.com/alphagov/notifications-api</em></a></p>
</li>
<li>
<p><a href="https://docs.nylas.com/reference"><em>https://docs.nylas.com/reference</em></a></p>
</li>
<li>
<p><a href="https://www.mailgun.com/"><em>https://www.mailgun.com/</em></a></p>
</li>
<li>
<p><a href="https://context.io/"><em>https://context.io/</em></a></p>
</li>
</ul>
<h3 id="handling-subscriptions-opt-in-opt-out">Handling subscriptions (opt-in / opt-out)</h3>
<p>To store subscriptions data (opt-in / opt-out) we can associate a
blacklist for every user in the system.</p>
<p>If we use SCIM we MUST add an extension to the SCIM core schema.</p>
<pre><code>optOut: [
{
  organization_id: &lt;id&gt;,
  topics: [ t1, t2, ... ]
}]
</code></pre>

<p>where <em>organization_id</em> is the identifier of the senders blocked by
users for some specific topics.</p>
<h2 id="openapis-mocking">OpenAPIs mocking</h2>
<h3 id="swaggerize">swaggerize</h3>
<p><a href="https://github.com/krakenjs/swaggerize-express">https://github.com/krakenjs/swaggerize-express</a></p>
<p>Mocks come from “swagmock”, but only this fork of swagmock:
<a href="https://github.com/fhoek/swagmock"><em>https://github.com/fhoek/swagmock</em></a>
supports "<em>allOf</em>" OpenAPI operator, so you MUST use this version and
not the one that comes from the original package.json in order to make it work:</p>
<pre><code>cat users.json |sed -e 's/faker/x\\-faker/' &amp;gt; .tmp &amp;&amp; mv .tmp users.json
npm install --save https://github.com/fhoek/swagmock
</code></pre>

<h3 id="json-schema-faker">json-schema-faker</h3>
<p><a href="https://github.com/json-schema-faker/json-schema-faker">https://github.com/json-schema-faker/json-schema-faker</a></p>
<p>Supports swagger format and generates 1 json with fake data for each endpoint</p>
<p>You can use it directly with
<a href="https://www.npmjs.com/package/swagger-routes"><em>https://www.npmjs.com/package/swagger-routes</em></a></p>
<p>without using swaggerize.</p>
<h3 id="swagger-node">swagger-node</h3>
<p>Based on “swagger tools”.</p>
<p>If you want to use it in mock mode you MUST add for every path the directive:</p>
<pre><code>&quot;x-swagger-router-controller&quot;: &quot;controllerName&quot;
</code></pre>

<p>see
<a href="https://github.com/swagger-api/swagger-node/issues/342"><em>https://github.com/swagger-api/swagger-node/issues/342</em></a></p>
<p>Does not emit fake data, but you can write custom controllers to mock it.
This activity is <strong>mandatory</strong> whenever there is a validation on the field format (ie. an email field)
otherwise the response object will fail validation.</p>
<p>swagger-node makes heavy use of <a href="https://github.com/apigee-127/bagpipes">bagpipes</a>, a weird
framework to code in YAML things you'd better write in Javascript.</p>
<p>As <a href="https://github.com/apigee-127/swagger-tools">swagger-tools</a> swagger-node seems <strong>deprecated / unmantained</strong>:<br />
https://github.com/apigee-127/swagger-tools/issues/335</p>
<h3 id="swagger-codegen">swagger-codegen</h3>
<p><a href="https://github.com/swagger-api/swagger-codegen"><em>https://github.com/swagger-api/swagger-codegen</em></a></p>
<p>Needs java + maven. Does not generate mock data.</p>
<p>Uses swagger-tools which, when used standalone, remove the
need to compile the java version of swagger-codegen: see
<a href="https://github.com/apigee-127/swagger-tools/blob/master/docs/QuickStart.md"><em>https://github.com/apigee-127/swagger-tools/blob/master/docs/QuickStart.md</em></a></p>
<p>You'd better start with swagger-tools or swagger-node directly.</p>
<h3 id="swagger-tools">swagger-tools</h3>
<p>swagger-node uses swagger-tools to set up its server.
Anyway, swagger-tools can be used standalone (without the bagpipes boilerplate):</p>
<p>https://github.com/apigee-127/swagger-tools/blob/master/docs/QuickStart.md</p>
<h3 id="swagger-express-middleware">swagger-express-middleware</h3>
<p>https://github.com/BigstickCarpet/swagger-express-middleware</p>
<p>Is a modern (unofficial) version of swagger-tools for express
(while swagger-tools are targeted as a connect middleware).</p>
<p>The project seems better maintained and popular than swagger-tools (~300k downloads on npm).
It lacks the routing middleware (so you have to use it with something like <a href="https://www.npmjs.com/package/swagger-routes">swagger-routes</a>).</p>
<p>It has an in-memory database to test mocked resources.</p>
<h3 id="swagger-server">swagger-server</h3>
<p>Uses swagger-express-middleware to implement a server (like swagger-node does with swagger-tools).
It provides the express routing middleware that swagger-express-middleware lacks.</p>
<h3 id="loopback-swagger-generator">loopback-swagger-generator</h3>
<p>https://loopback.io/doc/en/lb3/Swagger-generator.html</p>
<p>Generates routes and models (for persistence) from swagger specs.</p>
<h3 id="prism">Prism</h3>
<p><a href="http://stoplight.io/platform/prism/"><em>http://stoplight.io/platform/prism/</em></a></p>
<p>It’s a free mock Swagger server from Spotlight.io. The bad part is you
MUST embed some javascript code inside the Swagger specs to customize
controllers, which is not ideal.</p>
<h2 id="guidelines">Guidelines</h2>
<p><a href="https://zalando.github.io/restful-api-guidelines"><em>https://zalando.github.io/restful-api-guidelines</em></a></p>
<ul>
<li>Secure Endpoints with OAuth 2.0</li>
<li>Define and Assign Access Rights (Scopes)</li>
<li>Use
    &gt; <a href="https://zalando.github.io/restful-api-guidelines/compatibility/Compatibility.html#should-used-openended-list-of-values-xextensibleenum-instead-of-enumerations"><em>x-extensible-enum</em></a>
    &gt; (and string types)</li>
<li>Consider using ETag together with If-(None-)Match header</li>
<li>Always return Location header for POST</li>
<li>Pluralize Resource Names</li>
<li>Always Return JSON Objects As Top-Level Data Structures To Support
    &gt; Extensibility</li>
<li>Use Problem JSON
    &gt; <a href="https://zalando.github.io/problem/schema.yaml"><em>https://zalando.github.io/problem/schema.yaml</em></a></li>
<li><a href="https://en.wikipedia.org/wiki/List_of_ISO_639-1_codes"><em>https://en.wikipedia.org/wiki/List_of_ISO_639-1_codes</em></a></li>
<li>Use /api as first Path Segment</li>
<li>Empty array values should not be null</li>
<li>Boolean property values must not be null</li>
<li>...</li>
</ul>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href=".." class="btn btn-neutral" title="Home"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href=".." style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
    </span>
</div>

</body>
</html>
